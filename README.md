# Складской учет для интернет-магазина
Модуль интеграции интернет-магазина с системой складского и финансового учета <a href="https://www.webnice.biz/online-scif/" target="_blank">СКИФ</a> по формату CommerceML.
СКИФ написан на PHP+MySQL и устанавливается на вашем сайте. Для обмена по формату CommerceML система учета и интернет-магазин могут находиться на разных серверах, но установка обеих систем в одной базе расширяет возможности интеграции.
# Инструкция по установке
1. Скопируйте файлы из архива в папку установки СКИФ на вашем сайте с сохранением структуры директорий.
2. Добавьте в файл настроек wn_settings.php в корне установки системы следующий код (это можно сделать через меню Сервис-Редактор кода):
// Интеграция с интернет-магазином
$scif_actions[2090]=array('name'=>'Интернет-магазин','desc'=>'Интеграция с интернет-магазином по CommerceML','file'=>'cml','menu'=>3);
// Массив настроек для синхронизации с интернет-магазином (при необходимости, замените в массиве ID на GUID)
$cml=array(
'cml_id_type'=>'id', // тип формирования ID для новых элементов: 'id' - числовой код=ID элемента СКИФ или 'uuid()' - GUID
'class'=>array('id'=>'1','name'=>'Классификатор'), // классификатор
'owner'=>array('id'=>'1','name'=>'СКИФ','fullname'=>'СКИФ'), // владелец
'properties'=>array(
 2=>array('id'=>'2','name'=>'Бренд') // бренд (торговая марка)
 ),
'catalog'=>array('id'=>'1','name'=>'Основной каталог товаров'), // каталог
'offer'=>array('id'=>'1','name'=>'Пакет предложений (Основной каталог товаров)'), // пакет предложений
'offer_prices'=>array(2), // выгружаемые для пакета предложений типы цен
'currencies'=>array('643'=>array('name'=>'руб'),'840'=>array('name'=>'USD'),'978'=>array('name'=>'EUR'),'980'=>array('name'=>'грн')),
'offer_stores'=>array(1), // склады для количества товаров в пакете предложений
'where_spr_noms'=>'', // условие для выгрузки товаров и пакета предложений, например, n.store1>0 или n.parent IN (1,2)
// код группы в справочнике контрагентов в СКИФ, в которую будут добавляться покупатели интернет-магазина
'scif_contr_group'=>1,
// значения для создания документа в СКИФ при импорте заказа из магазина
// если задан contr, клиента берем из настроек, а не из файла
'invoice'=>array('user_insert'=>1,'org'=>1,'store'=>1,'manager'=>1,'type'=>2,'price_type'=>2),
'exchange_url'=>'', // адрес для автоматического обмена, получите его в панели управления CMS интернет-магазина
);

Операции импорта и экспорта можно выполнять вручную из меню "Торговля-Интернет-магазин" или автоматически по расписанию.
Если в вашем интернет-магазине уже есть товары, выгрузите их в файл обмена из панели управления интернет-магазина и загрузите в СКИФ.
После отладки обмена в ручном режиме, можно поставить обмен в планировщик, для этого добавьте в CRON на хостинге скрипт /cron/cml_cron.php с нужным вам расписанием.